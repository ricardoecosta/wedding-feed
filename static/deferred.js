!function(u){var f=Array.prototype.slice;function h(e){var t=[["resolve","done",u.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",u.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",u.Callbacks({memory:1})]],o="pending",s={state:function(){return o},always:function(){return c.done(arguments).fail(arguments),this},then:function(){var n=arguments;return h(function(o){u.each(t,function(e,i){var t=u.isFunction(n[e])&&n[e];c[i[1]](function(){var e=t&&t.apply(this,arguments);if(e&&u.isFunction(e.promise))e.promise().done(o.resolve).fail(o.reject).progress(o.notify);else{var n=this===s?o.promise():this,r=t?[e]:arguments;o[i[0]+"With"](n,r)}})}),n=null}).promise()},promise:function(e){return null!=e?u.extend(e,s):s}},c={};return u.each(t,function(e,n){var r=n[2],i=n[3];s[n[1]]=r.add,i&&r.add(function(){o=i},t[1^e][2].disable,t[2][2].lock),c[n[0]]=function(){return c[n[0]+"With"](this===c?s:this,arguments),this},c[n[0]+"With"]=r.fireWith}),s.promise(c),e&&e.call(c,c),c}u.when=function(e){var t,n,r,i=f.call(arguments),o=i.length,s=0,c=1!==o||e&&u.isFunction(e.promise)?o:0,a=1===c?e:h(),l=function(n,r,i){return function(e){r[n]=this,i[n]=1<arguments.length?f.call(arguments):e,i===t?a.notifyWith(r,i):--c||a.resolveWith(r,i)}};if(1<o)for(t=new Array(o),n=new Array(o),r=new Array(o);s<o;++s)i[s]&&u.isFunction(i[s].promise)?i[s].promise().done(l(s,r,i)).fail(a.reject).progress(l(s,n,t)):--c;return c||a.resolveWith(r,i),a.promise()},u.Deferred=h}(Zepto);